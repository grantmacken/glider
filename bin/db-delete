#!/usr/bin/env bash
set -Eeuo pipefail
declare -a args
args=("$@")
RED='\033[0;31m'
NC='\033[0m' # No Color
source .env
CURL="ghcr.io/grantmacken/podx-curl:${CURL_VER}"
CRL="podman run --rm --pod podx ${CURL} --silent --show-error -X DELETE --dump-header - "

function dash {
  printf %60s | tr ' ' '-' && echo
}

function msg() {
  echo >&2 -e "${1-}"
}

function die() {
  local msg=$(echo -n 'âœ˜  ' && echo $1)
  local code=${2-1} # default exit status 1
  msg "$msg"
  exit "$code"
}

case "${#args[@]}" in
1)
  BASE=$(echo $1 | grep -oP '^(src/data/)?\K(.+)$')
  SRC="src/data/$BASE"
  [ -f $SRC ] || die "[ $SRC ]: NOT a file "
  DIRNAME=$(dirname ${BASE})
  BASENAME=$(basename ${BASE})
  # EXT="${BASENAME##*.}"
  RESOURCE="${BASENAME%.*}"
  URI="http://localhost:8081/db/${DIRNAME}/${RESOURCE}"
  echo "##[ ${URI} ]##"
  ${CRL} "${URI}"
  ;;
*)
  die "Usage: $(basename "${BASH_SOURCE[0]}") [src] 1 arg required" 
  ;;
esac



